<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Part 4 - Educational Course</title>
    <link rel="stylesheet" href="../styles/main.css">
</head>
<body>
    <main>
        <h2>Deploy sample app</h2>
        <p>
            Lead To Opportunity sample application consists of BPMN, DMN and Form units.
            <br/>
            <ul>
                <li>BPMN - process def</li>
                <li>DMN - decision table</li>
                <li>Form - UI component</li>
                <li>Job Worker - custom app "toolkit"</li>
            </ul>
        </p>
        <section>
            <div class="copy-block">
                <p/>
                The "toolkit" folder has custom app. You may explore the code in VS Code IDE.
                <br/>
                <pre id="copy-text-6-1"><code>
We'll be using the pre-built Docker image for the custom app.
                </code></pre>
                <p/>
                <button class="copy-btn" onclick="copyToClipboard('copy-text-6-1', 'Make sure Docker Desktop app is running and Maven is accessible.')">Copy</button>
                <p/>
<br/>Check the image in this path: GCP console > Artifact Registry > asia-south2-docker.pkg.dev/c8-labs/c8-labs-repo
            </div>
            <p/>

            <div class="copy-block">
                <p/>
                Deploy the worker tookit JAR.<br/>
                <pre id="copy-text-6-2"><code>
envsubst '${UNAMESPACE}' < deploy-worker-toolkit.yaml  | kubectl apply  -f -
                </code></pre>
                <p/>
                <button class="copy-btn" onclick="copyToClipboard('copy-text-6-2')">Copy</button>
                <p/>
            </div>
            <p/>
           <div class="copy-block">
                <p/>
                Add ingress to enable traffic flow to the deployed services.<br/>
                <pre id="copy-text-5-4"><code>
envsubst '${UNAMESPACE}' < c8-ingress-with-toolkit.yaml | kubectl apply  -f -
                </code></pre>
                <p/>
                <button class="copy-btn" onclick="copyToClipboard('copy-text-5-4')">Copy</button>
                <p/>
You may check the ingress definition in the assigned namespace.
<br/>
            </div>
            <p/>

           <div class="copy-block">
                <p/>
                Deploy process artifacts.<br/>
                <pre id="copy-text-5-5"><code>
cd 1-lead-to-opportunity-dmn-form-webhook/
export ZEEBE_SECRET=$(kubectl get secret identity-secret-for-components -n $UNAMESPACE -o jsonpath="{.data.ZEEBE_SECRET}" | base64 --decode)
zbctl deploy --authzUrl=https://${UNAMESPACE}.makelabs.in/auth/realms/camunda-platform/protocol/openid-connect/token \
      --clientId=zeebe \
      --clientSecret=$ZEEBE_SECRET \
      --audience=zeebe \
      --address "${UNAMESPACE}-zeebe-gateway.makelabs.in:443" \
      --insecure=false \
       lead-to-opportunity-with-dmn.bpmn --certPath ../cert-origin_ca_rsa_root.pem 
zbctl deploy --authzUrl=https://${UNAMESPACE}.makelabs.in/auth/realms/camunda-platform/protocol/openid-connect/token \
      --clientId=zeebe \
      --clientSecret=$ZEEBE_SECRET \
      --audience=zeebe \
      --address "${UNAMESPACE}-zeebe-gateway.makelabs.in:443" \
      --insecure=false \
       new-lead-approval.dmn --certPath ../cert-origin_ca_rsa_root.pem 
zbctl deploy --authzUrl=https://${UNAMESPACE}.makelabs.in/auth/realms/camunda-platform/protocol/openid-connect/token \
      --clientId=zeebe \
      --clientSecret=$ZEEBE_SECRET \
      --audience=zeebe \
      --address "${UNAMESPACE}-zeebe-gateway.makelabs.in:443" \
      --insecure=false \
       lead-to-opportunity-with-webhook-Form.form --certPath ../cert-origin_ca_rsa_root.pem 
cd ..
                </code></pre>
                <p/>
                <button class="copy-btn" onclick="copyToClipboard('copy-text-5-5')">Copy</button>
                <p/>
You may check the deployment status via <a target="_blank" href="https://$UNAMESPACE.makelabs.in/operator/">Operator</a> console.
<br/>
            </div>
            <p/>

        </section>
    </main>
    <script src="../scripts/app.js"></script>
</body>
</html>